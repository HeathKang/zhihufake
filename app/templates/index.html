<meta charset="UTF-8">
{% extends "base.html" %}
{% import "bootstrap/wtf.html" as wtf %}
{% import "_macros.html" as macros %}

{% block title %}知乎fake{% endblock %}

{% block page_content %}
<div class="top-title-left">
	<span class="glyphicon glyphicon-list-alt"></span>最新动态

</div>
	<ul class="nav nav-tabs" role="tablist" style="width:800px">
    <li role="presentation" class="{% if show_post %} active {% endif %}"><a style="padding:5px 10px;" href="{{ url_for('.show_post')}}">问题</a></li>
    <li role="presentation" class="{% if not show_post %} active {% endif %}"><a style="padding:5px 10px;" href="{{ url_for('.show_answer')}}">答案</a></li>

	</ul>
<div class="tab-content">
	<div class="followed_posts {% if show_post %} active {% else %} hide {% endif %}">
		<div class="post">
			{% include '_posts.html' %}
		</div>
		<button id="btn-questions" class="btn btn-default long-button" data-style="expand-left"><span class="ladda-label">加载更多</span></button>
		{% if pagination %}
		<div class="pagination">
			{{ macros.pagination_widget(pagination,'.index') }}
		</div>
	</div>
	<div class="followed_answers {% if not show_post %} active {% else %} hide {% endif %}">
		<div class="answer">
			{% include '_index_answers.html'%}
		</div>
		<button id="btn-answers" class="btn btn-default long-button" data-style="expand-left"><span class="ladda-label">加载更多</span></button>
		{% if pagination %}
		<div class="pagination">
			{{ macros.pagination_widget(pagination,'.index') }}
		</div>
		{% endif %}
	</div>
</div>

{% endif %}
{% endblock %}


{% block scripts%}
{{ super() }}
<script type=text/javascript>
var page = 2;

$('button#btn-questions').click(function () {
    $.ajax({
        url: '/_load_questions?page=' + page + '&content=index',
        method: 'post',
        dataType: 'json'
    }).done(function(response){
        if (response.result) {
            $('div.post').append(response.html);
            page++;
            for (var i=0;i<response.posts.length;i++)
            {
             $("div#" + response.post_id[i]).append(moment(response.posts[i]).fromNow() );
             };
        }
    });
});

$('button#btn-answers').click(function () {
    $.ajax({
        url: '/_load_answers?page=' + page + '&content=index',
        method: 'post',
        dataType: 'json'
    }).done(function(response){
        if (response.result) {
            $('div.answer').append(response.html);
            page++;
             for (var i=0;i<response.answers.length;i++)
            {
             $("div#answer-" + response.answer_id[i]).append(moment(response.answers[i]).fromNow());
             };
        }
    });
});

$(document).ready(function(){
    $(".search-answer-answer").each(function()
        { var maxwidth=120;
         if($(this).text().length>maxwidth){
         $(this).text($(this).text().substring(0,maxwidth));
        $(this).html($(this).html()+'...');
        }
    });
 });


</script>


{% endblock %}